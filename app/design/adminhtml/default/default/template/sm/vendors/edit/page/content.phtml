<?php	// get WYSIWYG config	$wysiwygConfig = Mage::getSingleton('cms/wysiwyg_config')->getConfig(        array('tab_id' => $this->getTabId())    );        $element = new Varien_Data_Form_Element_Editor();       $newData = $wysiwygConfig->getData();        $newData['files_browser_window_url'] = str_replace('/cmsgui/cms','/admin/cms',$newData['files_browser_window_url']);    $newData['directives_url'] = str_replace('/cmsgui/cms','/admin/cms',$newData['directives_url']);    $newData['directives_url_quoted'] = str_replace('/cmsgui/cms','/admin/cms',$newData['directives_url_quoted']);    $newData['directives_url_quoted'] = str_replace('/cmsgui/cms','/admin/cms',$newData['directives_url_quoted']);    $newData['widget_window_url'] = str_replace('/cmsgui/widget','/admin/widget',$newData['widget_window_url']);    $newData['plugins'][0]['options']['url'] = str_replace('/cmsgui/system','/admin/system',$newData['plugins'][0]['options']['url']);    $newData['plugins'][0]['options']['onclick']['subject'] = str_replace('/cmsgui/system','/admin/system',$newData['plugins'][0]['options']['onclick']['subject']);    $newData['width'] = Mage::getStoreConfig('cmsgui/tiny_mce/width');    $newData['height'] = Mage::getStoreConfig('cmsgui/tiny_mce/height');        $element->getConfig()->addData($newData);        // add Firebug notice translations    $element->getConfig()->addData(array(        'firebug_warning_title'  => $element->translate('Warning'),        'firebug_warning_text'   => $element->translate('Firebug is known to make the WYSIWYG editor slow unless it is turned off or configured properly.'),        'firebug_warning_anchor' => $element->translate('Hide'),    ));        $wysiwygConfigJson = Zend_Json::encode($element->getConfig());    	// inline translations	$translatedString = array(        'Insert Image...' => $element->translate('Insert Image...'),        'Insert Media...' => $element->translate('Insert Media...'),        'Insert File...' => $element->translate('Insert File...')    );?><div class="entry-edit">  <div class="entry-edit-head">    <h4 class="icon-head head-edit-form fieldset-legend"><?php echo Mage::helper('smvendors')->__('Static page')?></h4>	<div class="right"><?php echo $this->getAddButtonHtml() ?></div>  </div>  <div id="group_fields4" class="fieldset fieldset-wide">    <div class="hor-scroll">      <table cellspacing="0" class="form-list">        <tbody>          <tr>            <td>				<div class="grid tier form-list">					<table cellspacing="0" cellpadding="0" class="border">						<thead>							<tr class="headings">								<th style="width:150px"><?php echo Mage::helper('smvendors')->__('Meta data')?></th>								<th style="width:350px"><?php echo Mage::helper('smvendors')->__('Content')?></th>								<th style="width:120px"><?php echo Mage::helper('smvendors')->__('Active')?></th>								<th><?php echo Mage::helper('smvendors')->__('Action')?></th>							</tr>						</thead>						<tbody id="vendors_page_container_top">						</tbody>					</table>					<input type="hidden" name="vendors" id="" value=""/>				</div>            </td>          </tr>        </tbody>      </table>    </div>  </div></div><script type="text/javascript">imageTemplate = '	<tr id="vendor_page_row_{{index}}">\						<td>\							<input type="text" value="{{id}}" name="vendorPages[{{index}}][id]" id="vendor_page_id_{{index}}" class="input-text vendor-page" rel="vendor_page_id_{{index}}"/>\							<label></label><input type="text" value="{{title}}" name="vendorPages[{{index}}][title]" id="vendor_page_title_{{index}}" class="input-text"/>\						</td>\						<td>\							<button type="button" class="scalable show-hide" onclick="vendorPages.applyWysiwyg(\'vendor_page_content_{{index}}\',\'{{index}}\')" style="" id="togglevendor_page_content_{{index}}"><span>Show / Hide Editor</span></button>\					 		<button type="button" class="scalable add-image plugin" onclick="MediabrowserUtility.openDialog(\'<?php echo $element->getConfig('files_browser_window_url') . "target_element_id/"; ?>vendor_page_content_{{index}}/<?php echo ((null !== $element->getConfig('store_id')) ? ('store/' . $element->getConfig('store_id') . '/') : ''); ?>\')" ><span>Insert Image...</span></button>\							<textarea name="vendorPages[{{index}}][content]" id="vendor_page_content_{{index}}" style="width:400px;height:400px" class="input-text">{{content}}</textarea>\						</td>\						<td>\							<input type="checkbox" name="vendorPages[{{index}}][enable]" id="vendor_page_content_{{index}}"/>\						</td>\						<td>\							<button id="btn_remove_page_{{index}}" type="button" class="scalable delete" onclick="vendorPages.remove({{index}})" style=""><span>Delete</span></button>\						</td>\					</tr>\				';					</script><script type="text/javascript">//<![CDATA[    openEditorPopup = function(url, name, specs, parent) {        if ((typeof popups == "undefined") || popups[name] == undefined || popups[name].closed) {            if (typeof popups == "undefined") {                popups = new Array();            }            var opener = (parent != undefined ? parent : window);            popups[name] = opener.open(url, name, specs);        } else {            popups[name].focus();        }        return popups[name];    }    closeEditorPopup = function(name) {        if ((typeof popups != "undefined") && popups[name] != undefined && !popups[name].closed) {            popups[name].close();        }    }//]]></script><script type="text/javascript">var wysiwygAreas = new Array();VendorPages = Class.create();VendorPages.prototype = {    idLabel : 'page',    top : '',    templateSyntax : /(^|.|\r|\n)({{(\w+)}})/,    templateText : '',    itemsCount : 0,    initialize : function(template) {        this.templateText = template;        this.top = $('vendors_page_container_top');    },    add : function(data) {        if(!data){            data = {};            this.top = $('vendors_page_container_top');        }        data.index = this.itemsCount++;        this.template = new Template(this.templateText, this.templateSyntax);        Element.insert(this.top, {'bottom':this.template.evaluate(data)});        //set selected type        if (data.type) {            $A($(this.idLabel + '_'+data.index+'_type').options).each(function(option){                if (option.value==data.type) option.selected = true;            });        }        //set selected is_require        if (data.required) {            $A($(this.idLabel + '_'+data.index+'_required').options).each(function(option){                if (option.value==data.required) option.selected = true;            });        }        // rebind change notifications        varienWindowOnload(true);        return data.index;    },    remove : function(videoId){        var element = $('vendor_page_row_'+videoId).remove();		this.updateGalery();    },	changeVideo: function(input){			},	applyWysiwyg : function( obj,index){		var arrKey = index; 		wysiwygAreas[arrKey] = new tinyMceWysiwygSetup(obj,<?php echo $wysiwygConfigJson; ?>);				editorFormValidationHandler = wysiwygAreas[arrKey].onFormValidation.bind(wysiwygAreas[arrKey]);		Event.observe("toggle"+obj, "click", wysiwygAreas[arrKey].toggle.bind(wysiwygAreas[arrKey]));		varienGlobalEvents.attachEventHandler("formSubmit", editorFormValidationHandler);			varienGlobalEvents.attachEventHandler("tinymceBeforeSetContent", wysiwygAreas[arrKey].beforeSetContent.bind(wysiwygAreas[arrKey]));		varienGlobalEvents.attachEventHandler("tinymceSaveContent", wysiwygAreas[arrKey].saveContent.bind(wysiwygAreas[arrKey]));		varienGlobalEvents.attachEventHandler("open_browser_callback", wysiwygAreas[arrKey].openFileBrowser.bind(wysiwygAreas[arrKey]));					wysiwygAreas[arrKey].setup("exact");	},}var optionIndex = 0;vendorPages = new VendorPages(imageTemplate);//adding data to templates<?php foreach ($this->getAllPages() as $_page): ?>optionIndex = vendorPages.add(<?php echo json_encode($_page) ?>);<?php endforeach; ?></script>